{% extends 'base.html' %}
{% load custom_tags %}
{% load staticfiles %}
<body>
{% block content %}
    <div class="modal fade" tabindex="-1" role="dialog" id="modal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
            </div>
        </div>
    </div>
    <div id="map">
    </div>
{% endblock %}
{% block additional_static_files %}
    <link rel="stylesheet" href="/static/css/map.css" type="text/css"/>
    <link rel="stylesheet" type="text/css" href="{% static 'map/css/style.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'map/css/icons.css' %}"/>

    <script src="{% static 'js/map.js' %}"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCB8zr2YDVYWGhgYZsEfkPDZnwOL_UF21A&callback=initMap&language=uk"></script>
    <script src="https://www.googleapis.com/geolocation/v1/geolocate?key=AIzaSyDevOz4ccaGWa0v8-0ALkxADKIHca2cLnA"></script>
    <script src="{% static 'js/userMarker.js' %}"></script>
    <script defer>
        {% for region_name, info in regions_info.items %}
            let {{ region_name|lower }} = {{ info|get_item:'coords'|safe }}
            let {{ region_name|lower }}Polygon = new google.maps.Polygon({
                paths: {{ region_name|lower }},
                strokeColor: '{{ info|get_item:'hex_color'|safe }}',
                strokeOpacity: 0.8,
                strokeWeight: 3,
                fillColor: '{{ info|get_item:'hex_color'|safe }}',
                fillOpacity: 0.35
            });
            {{ region_name|lower }}Polygon.setMap(map);
        {% endfor %}
    </script>
    <script defer>
        var icon = {
            url: 'https://i.dlpng.com/static/png/1780489_preview.png',
            scaledSize: new google.maps.Size(50, 50)
        };
        {% for marker in markers %}
            let m{{ marker.id }} = new google.maps.Marker({
                position: {lat: {{ marker.latitude }}, lng: {{ marker.longitude }}},
                icon: icon,
                map: map,
                title: "{{ marker.name }}",
                animation: google.maps.Animation.BOUNCE,
                draggable: false
            });
            m{{ marker.id }}.set(map);
            m{{ marker.id }}.set('id', 'marker-{{ marker.id }}');
            m{{ marker.id }}.addListener('click',
                function () {
                    displayMarkerInfo(m{{ marker.id }})
                }
            );
        {% endfor %}
    </script>
    <script src="{% static 'map/js/mo.min.js' %}"></script>
    <script src="{% static 'map/js/icons.js' %}"></script>
{% endblock %}